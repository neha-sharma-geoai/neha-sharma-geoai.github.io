<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*6wmhPTBQWfNSIPVm"><figcaption>Photo by <a href="https://unsplash.com/@98mohitkumar?utm_source=medium&amp;utm_medium=referral" rel="external nofollow noopener" target="_blank">Mohit Kumar</a> onÂ <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="external nofollow noopener" target="_blank">Unsplash</a></figcaption></figure> <p>Geospatial data plays a crucial role in various domains, from remote sensing and urban planning to environmental monitoring and disaster management. When working with geospatial data for machine learning tasks, preparing a custom dataloader is essential to efficiently load, preprocess, and augment the data without losing its properties, especially when the input image has more than 3Â bands.</p> <p><strong>Rasterio </strong>is indeed a specialized library designed explicitly for handling geospatial raster data efficiently. While libraries like OpenCV and Pillow are versatile and widely used for image processing, they may not provide the specialized geospatial capabilities and optimizations offered by Rasterio.</p> <p>Rasterio is tailored to work seamlessly with geospatial file formats such as GeoTIFF, and it provides tools for georeferencing, coordinate transformations, and other geospatial-specific tasks. This makes it an essential choice when working with geospatial data, as it ensures accurate handling of spatial information, coordinate systems, and map projections.</p> <p>So, when dealing with geospatial raster datasets, Rasterio is often the preferred choice. However, OpenCV and Pillow can still be useful in certain scenarios, especially when you need to perform general image processing tasks on geospatial data, when youâ€™re working with non-geospatial image data, or when you just want to read three bands of an image without retaining its geospatial properties.</p> <p>In this tutorial, we will walk you through the process of creating a custom geospatial dataloader using PyTorch and Rasterio, two powerful libraries for deep learning and geospatial analysis.</p> <p>Prerequisites: Before we begin, ensure you have the following requirements:</p> <ol> <li>An IDE like <a href="https://jupyter.org/" rel="external nofollow noopener" target="_blank">Jupyter Notebook</a>.</li> <li> <a href="https://www.python.org/" rel="external nofollow noopener" target="_blank">Python </a>and the required libraries are installed.</li> <li> <a href="https://pytorch.org/" rel="external nofollow noopener" target="_blank">PyTorch </a>and <a href="https://rasterio.readthedocs.io/en/stable/intro.html" rel="external nofollow noopener" target="_blank">Rasterio </a>installed. You can install them usingÂ pip:</li> </ol> <pre>pip install torch torchvision rasterio</pre> <p>If you face trouble installing Rasterio, the best way I have found is to do it in the following sequence:</p> <pre>pip install wheel<br>pip install pipwin<br><br>pipwin install numpy<br>pipwin install pandas<br>pipwin install shapely<br>pipwin install gdal<br>pipwin install fiona<br>pipwin install pyproj<br>pipwin install six<br>pipwin install rtree<br>pipwin install geopandas<br>pip install rasterio</pre> <p>Source: <a href="https://stackoverflow.com/a/58943939/14111919" rel="external nofollow noopener" target="_blank">https://stackoverflow.com/a/58943939/14111919</a></p> <p>Once you have all the libraries installed, let's create a custom geospatial data loader. The following steps have to be followed in yourÂ IDE:</p> <ol> <li>Import libraries</li> <li>Define CustomÂ Dataset</li> <li>Create a dataÂ loader</li> <li>Iterate throughÂ batches</li> </ol> <p>Letâ€™s begin with theseÂ steps.</p> <h3><strong>Import Libraries</strong></h3> <pre>import torch<br>from torch.utils.data import Dataset, DataLoader<br>import rasterio<br>import numpy as np<br>from torchvision import transforms</pre> <h3><strong>Define CustomÂ Dataset</strong></h3> <p>Create a custom dataset class that inherits from PyTorchâ€™s Dataset class. In this class, you will define how to load and preprocess geospatial data.</p> <pre>class CustomGeoDataset(Dataset):<br>    def __init__(self, file_paths, transform=None):<br>        self.file_paths = file_paths  # List of file paths for geospatial data<br>        self.transform = transform  # Data augmentation/transformations<br><br>    def __len__(self):<br>        return len(self.file_paths)<br><br>    def __getitem__(self, idx):<br>        # Open the geospatial file using Rasterio<br>        with rasterio.open(self.file_paths[idx], 'r') as src:<br>            data = src.read()  # Read the data (e.g., satellite imagery)<br>            # Apply any preprocessing or transformations here<br>            if self.transform:<br>                data = self.transform(data)<br>        return data</pre> <pre># Define the list of file paths to your geospatial data files<br>file_paths = ['path_to_file1.tif', 'path_to_file2.tif', ...]<br><br># Instantiate the custom dataset<br>custom_dataset = CustomGeoDataset(file_paths)</pre> <p>You can create the list of file paths with the osÂ library.</p> <p><strong>Data Augmentation (Optional)</strong></p> <p>If you wish to apply data augmentation or transformations to your geospatial data, you can define custom transformation functions using PyTorchâ€™s transforms module and pass them to the dataset during initialization.</p> <pre># Define custom data augmentation/transformations<br>custom_transforms = transforms.Compose([<br>    transforms.RandomHorizontalFlip(),<br>    transforms.RandomVerticalFlip(),<br>    transforms.RandomRotation(15),<br>    # Add more transformations as needed<br>])<br><br># Instantiate the custom dataset with transformations<br>custom_dataset = CustomGeoDataset(file_paths, transform=custom_transforms)</pre> <h3>Create Dataloader</h3> <pre># Create a DataLoader for batching and parallel data loading<br>dataloader = DataLoader(custom_dataset, batch_size=32, shuffle=True)</pre> <h3>Iterate throughÂ Batches</h3> <p>You can now iterate through the batches of geospatial data using the DataLoader and use them for training or inference in your deep learningÂ model.</p> <pre>for batch in dataloader:<br>    # Perform model training or inference with the batch data<br>    # Make sure your model is compatible with the input data format</pre> <p>After this, try visualizing the dataset, and checking its shape and length to verify if the dataloader has been generated correctly.</p> <p>Creating a custom geospatial dataloader with PyTorch and Rasterio enables you to efficiently handle geospatial data for various machine learning or deep learning tasks. This tutorial provides the foundation for loading and preprocessing geospatial data, and you can further customize it to suit your specific project requirements. Whether youâ€™re working on land cover classification, object detection, or any other geospatial task, a custom dataloader will streamline your workflow and help you achieve accurate results with geospatial datasets.</p> <p>This installment of the series has provided you with a guide on creating a geospatial dataloader using the rasterio library. In our upcoming segment, we will take this knowledge a step further by creating a custom geospatial dataloader and presenting a practical datasetÂ example.</p> <p>Stay tuned for a hands-on demonstration of how to harness the power of geospatial data in your machine learning projects.</p> <p><strong>Follow me to stay updated on upcoming geospatial articles! ðŸ””</strong></p> <p>Thank you for reading this article.Â :)</p> <p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=4f6d896ef441" width="1" height="1" alt=""></p> </body></html>